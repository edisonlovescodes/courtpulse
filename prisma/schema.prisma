generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id
  createdAt DateTime @default(now())
}

// Tracks which game a user unlocked in a time period
model GameUnlock {
  id          Int      @id @default(autoincrement())
  userId      String
  gameId      String
  period      String   // 'day' | 'week'
  periodStart DateTime
  createdAt   DateTime @default(now())

  @@unique([userId, gameId, period, periodStart])
  @@index([userId, period, periodStart])
}

// Usage tracking per game period (e.g., quarter)
model GameView {
  id        Int      @id @default(autoincrement())
  userId    String
  gameId    String
  period    Int
  createdAt DateTime @default(now())

  @@unique([userId, gameId, period])
  @@index([userId, gameId])
}

// Company notification settings
model NotificationSettings {
  id                   Int      @id @default(autoincrement())
  companyId            String   @unique
  enabled              Boolean  @default(false)
  channelId            String?  // Whop chat channel ID
  channelName          String?  // Display name for UI
  updateFrequency      String   @default("every_point") // 'every_point' | 'every_minute' | 'every_quarter'
  notifyGameStart      Boolean  @default(true)
  notifyGameEnd        Boolean  @default(true)
  notifyQuarterEnd     Boolean  @default(true)
  trackedGames         String   @default("") // Comma-separated game IDs
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
}

// Track last notification state per game to avoid duplicates
model GameNotificationState {
  id                Int      @id @default(autoincrement())
  companyId         String
  gameId            String
  lastHomeScore     Int      @default(0)
  lastAwayScore     Int      @default(0)
  lastPeriod        Int      @default(0)
  lastStatus        String   @default("")
  lastNotifiedAt    DateTime @default(now())

  @@unique([companyId, gameId])
  @@index([companyId])
}
